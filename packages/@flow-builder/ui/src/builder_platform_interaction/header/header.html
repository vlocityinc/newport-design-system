<template>
    <div class="slds-builder-header flow-builder-header_border_icon">
        <div class="slds-builder-header__item" if:true={backUrl}>
            <a href={backUrl} class="slds-builder-header__item-action test-back-url">
                <lightning-icon
                    variant="inverse"
                    size="x-small"
                    icon-name="utility:back"
                    class="slds-icon_container slds-icon-utility-back slds-current-color test-back-utility-icon"
                    title={labels.backButtonText}
                    onfocus={handleBackFocus}
                    onblur={handleBackBlur}
                    onmouseover={handleBackFocus}
                    onmouseout={handleBackBlur}
                >
                </lightning-icon>
            </a>
            <div class={backTooltipClass} role="tooltip" id="backTooltip">
                <div class="slds-popover__body">{labels.backButtonText}</div>
            </div>
        </div>
        <div class="slds-builder-header__item">
            <div class="slds-builder-header__item-label slds-media slds-media_center">
                <lightning-icon
                    variant="inverse"
                    size="x-small"
                    icon-name={iconName}
                    class="slds-media__figure test-flow-utility-icon"
                ></lightning-icon>
                <div class="slds-media__body test-app-name" aria-hidden="true">{name}</div>
            </div>
        </div>
        <h1
            if:true={currentFlowName}
            title={flowNameAndVersionTitle}
            class="slds-builder-header__item custom-item-width test-flow-name-version-title"
        >
            <span class="custom-builder-header__item-label slds-p-left_medium slds-truncate test-flow-name"
                >{currentFlowName}</span
            >
            &nbsp;
            <span class="custom-builder-header__item-label slds-p-right_medium test-flow-version"
                >{flowVersionNumber}</span
            >
        </h1>
        <div class="slds-builder-header__item" if:true={overriddenFlow}>
            <lightning-badge
                label={labels.overrideBadge}
                title={labels.overrideBadge}
                class={badgeClasses}
                tabindex="0"
            >
            </lightning-badge>
        </div>
        <lightning-badge if:true={isSystemMode} label={systemModeLabel} title={systemModeLabel} class={badgeClasses}>
        </lightning-badge>
        <h1 if:true={showLabel} class={cssClassForHeaderLabel}>{formattedHeaderLabel}</h1>
        <lightning-badge if:true={showBadgeStatus} label={badgeStatus} class={badgeClass}> </lightning-badge>
        <div class="slds-builder-header__item slds-builder-header__utilities">
            <template if:false={isGuardrailsEnabled}>
                <div class="slds-builder-header__utilities-item">
                    <a
                        href={helpUrl}
                        target="_blank"
                        class="slds-builder-header__item-action slds-media slds-media_center test-help-url"
                        onclick={handleClickHelp}
                    >
                        <div class="slds-media__figure">
                            <lightning-icon
                                variant="inverse"
                                size="x-small"
                                icon-name="utility:help"
                                class="slds-icon_container slds-icon-utility-back slds-current-color test-help-utility-icon"
                            >
                            </lightning-icon>
                        </div>
                        <div class="slds-media__body test-help-label">{labels.helpButtonText}</div>
                    </a>
                </div>
            </template>

            <template if:true={isGuardrailsEnabled}>
                <div class="slds-builder-header__utilities-item">
                    <div class="slds-builder-header__item-action">
                        <lightning-button-menu
                            icon-name="utility:help"
                            menu-alignment="right"
                            variant="bare-inverse"
                            nubbin
                        >
                            <lightning-menu-item
                                href={helpUrl}
                                target="_blank"
                                label={labels.helpText}
                                onclick={handleClickHelp}
                            ></lightning-menu-item>
                            <lightning-menu-item
                                label={labels.keyboardHelpText}
                                onclick={handleClickKeyboardHelp}
                            ></lightning-menu-item>
                            <lightning-menu-item
                                href={trailheadUrl}
                                target="_blank"
                                label={labels.trailheadText}
                                onclick={handleClickTrailhead}
                            ></lightning-menu-item>
                            <lightning-menu-item
                                href={trailblazerCommunityUrl}
                                target="_blank"
                                label={labels.trailblazerCommunityText}
                                onclick={handleClickTrailblazerCommunity}
                            ></lightning-menu-item>

                            <lightning-menu-divider></lightning-menu-divider>

                            <analyzer_framework-help-menu-item
                                type="view"
                                label={labels.viewGuardrailsText}
                                count={guardrailsParams.count}
                                running={guardrailsParams.running}
                                onclick={handleClickViewGuardrails}
                            ></analyzer_framework-help-menu-item>
                            <analyzer_framework-help-menu-item
                                type="mute"
                                label={labels.muteGuardrailsText}
                                unmute-label={labels.unmuteGuardrailsText}
                                running={guardrailsParams.running}
                                onclick={handleClickMuteGuardrails}
                            ></analyzer_framework-help-menu-item>
                        </lightning-button-menu>
                    </div>
                </div>
            </template>
        </div>
    </div>
</template>
