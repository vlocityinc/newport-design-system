<template>
    <div class="slds-p-horizontal_small slds-p-top_small">{labels.recordUpdateTitle}</div>
    <div class="slds-p-horizontal_small slds-p-top_small">
        <builder_platform_interaction-label-description
            label={state.recordUpdateElement.label}
            dev-name={state.recordUpdateElement.name}
            description={state.recordUpdateElement.description}
            guid={state.recordUpdateElement.guid}
            onpropertychanged={handlePropertyOrListItemChanged}
            mode={mode}
        >
        </builder_platform_interaction-label-description>
    </div>

    <div class="slds-border_top">
        <div class="slds-form_stacked slds-p-around_small slds-no-flex">
            <lightning-radio-group
                class="slds-m-top_x-small"
                name="recordCreateOrUpdate"
                label={labels.waysToFindRecordsTitle}
                options={wayToFindRecordOptions}
                onchange={handleWayToFindOptionChanged}
                value={wayToFindRecordsValue}
                required
                type="radio"
                disabled={isDisabled}
            ></lightning-radio-group>
            <div
                if:true={showWayToFindInfoMessage}
                class="slds-scoped-notification slds-m-right_small slds-m-top_x-small slds-media slds-media_center slds-color__background_gray-3"
            >
                <div class="slds-media__figure">
                    <lightning-icon icon-name="utility:info" size="small"></lightning-icon>
                </div>
                <div class="slds-media__body">
                    <lightning-formatted-rich-text
                        value={labels.wayToFindRecordsInfoMessage}
                    ></lightning-formatted-rich-text>
                </div>
            </div>
        </div>
    </div>

    <div if:true={showSobjectPicker}>
        <div class="slds-m-bottom_small slds-border_top">
            <h3 class="slds-text-heading_small slds-p-around_small">{sObjectPickerHeader}</h3>
            <div
                if:false={isRelatedRecordLookup}
                class="slds-p-horizontal_small slds-form-element slds-size_1-of-2 slds-m-bottom_small"
            >
                <builder_platform_interaction-sobject-or-sobject-collection-picker
                    label={sObjectPickerLabel}
                    placeholder={sObjectPickerPlaceholder}
                    value={inputReference}
                    row-index={state.recordUpdateElement.inputReferenceIndex.value}
                    error-message={state.recordUpdateElement.inputReference.error}
                    sobject-collection-criterion={sobjectCollectionCriterion}
                    crud-filter={crudFilter}
                    onsobjectreferencechanged={handleInputReferenceChangedEvent}
                    is-pill-supported
                >
                </builder_platform_interaction-sobject-or-sobject-collection-picker>
            </div>
            <div
                if:true={isRelatedRecordLookup}
                class="slds-p-horizontal_small slds-form-element slds-size_1-of-2 slds-m-bottom_small"
            >
                <builder_platform_interaction-related-record-fields-picker
                    label={sObjectPickerLabel}
                    placeholder={sObjectPickerPlaceholder}
                    value={inputReference}
                    row-index={state.recordUpdateElement.inputReferenceIndex.value}
                    error-message={state.recordUpdateElement.inputReference.error}
                    onupdaterelatedrecordfieldschanged={handleRelatedRecordFieldsChangedEvent}
                    onfetchmenudata={handleFetchMenuData}
                >
                </builder_platform_interaction-related-record-fields-picker>
            </div>
            <div if:true={isRelatedRecordLookup} class="slds-p-horizontal_small slds-form-element slds-m-bottom_small">
                <span>{relatedRecordFieldsPickerHelpText}</span>
            </div>
        </div>
        <div if:false={isRelatedRecordLookup}>
            <div class="slds-p-horizontal_small slds-m-bottom_small slds-grid">
                <div class="slds-m-top_xx-small">
                    <span>{labels.helpIdFieldPopulatedWithTextForUpdate}</span>
                </div>
                <lightning-helptext
                    class="slds-m-left_xx-small"
                    content={labels.helpSObjectRecordUpdateAltText}
                ></lightning-helptext>
            </div>
        </div>
    </div>
    <div if:true={isRecordLookup} class="slds-m-bottom_small slds-border_top fieldAssignmentNotSupported">
        <div class="slds-m-bottom_small slds-border_top">
            <h3 class="slds-text-heading_small slds-p-around_small">{labels.updateRecordOfThisObject}</h3>
            <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2">
                <builder_platform_interaction-entity-resource-picker
                    combobox-config={entityComboboxConfig}
                    value={objectName}
                    row-index={state.recordUpdateElement.objectIndex.value}
                    crud-filter-type={crudFilterType}
                    oncomboboxstatechanged={handleResourceChanged}
                    onitemselected={handleResourceChanged}
                >
                </builder_platform_interaction-entity-resource-picker>
            </div>
        </div>
    </div>
    <div if:true={showConditionsAndAssignments}>
        <!-- Find Records section -->
        <builder_platform_interaction-record-filter
            show-prefix
            element-type={state.recordUpdateElement.elementType}
            element-guid={state.recordUpdateElement.guid}
            filter-items={state.recordUpdateElement.filters}
            filter-logic={state.recordUpdateElement.filterLogic}
            filter-logic-options={recordFilterOptions}
            show-warning-message={showWarningMessage}
            is-singular={isTriggeringOrRelatedRecord}
            title={recordFilterTitle}
            record-entity-name={recordEntityName}
            record-fields={recordFieldsToFilter}
            onaddrecordfilter={handlePropertyOrListItemChanged}
            onupdaterecordfilter={handlePropertyOrListItemChanged}
            ondeleterecordfilter={handlePropertyOrListItemChanged}
            onpropertychanged={handlePropertyOrListItemChanged}
        >
        </builder_platform_interaction-record-filter>

        <!-- InputAssignments fields -->
        <builder_platform_interaction-record-input-output-assignments
            input-output-assignments-items={state.recordUpdateElement.inputAssignments}
            resource-display-text={resourceDisplayText}
            record-entity-name={recordEntityName}
            record-fields={recordFieldsToUpdate}
            element-type={state.recordUpdateElement.elementType}
            title={assignmentTitle}
            rhs-label={labels.filterRhsLabel}
            onupdaterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
            onaddrecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
            ondeleterecordfieldassignment={handleRecordInputOutputAssignmentsChanged}
        >
        </builder_platform_interaction-record-input-output-assignments>
    </div>
</template>
