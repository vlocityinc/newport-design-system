<template>
    <div if:true={hasConfigurationEditor} class="slds-m-bottom_small slds-border_top">
        <builder_platform_interaction-custom-property-editor
            configuration-editor={configurationEditor}
            configuration-editor-input-variables={configurationEditorValues}
            onconfiguration_editor_input_value_changed={handleValueChanged}
        ></builder_platform_interaction-custom-property-editor>
    </div>

    <div if:false={hasConfigurationEditor}>
        <div class="slds-p-around_medium">
            <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2">
                <div class="slds-text-heading_medium">{editTriggerObjectLabel}</div>
                <div
                    class="test-context-object-description slds-text-body_small slds-text-color_weak slds-p-vertical_x-small"
                >
                    {contextObjectDescription}
                </div>
            </div>

            <div class="slds-p-horizontal_small slds-form-element slds-size_1-of-2">
                <builder_platform_interaction-entity-resource-picker
                    if:true={showScheduleSection}
                    combobox-config={entityComboboxConfig}
                    value={startElement.object.value}
                    row-index={startElement.objectIndex.value}
                    crud-filter-type={queryableFilter}
                    oncomboboxstatechanged={handleResourceChanged}
                    onitemselected={handleResourceChanged}
                >
                </builder_platform_interaction-entity-resource-picker>

                <!-- Used for before/after save triggerType-->
                <builder_platform_interaction-entity-resource-picker
                    if:false={showScheduleSection}
                    combobox-config={entityComboboxConfigRequired}
                    value={startElement.object.value}
                    row-index={startElement.objectIndex.value}
                    crud-filter-type={workflowEnabledFilter}
                    oncomboboxstatechanged={handleResourceChanged}
                    onitemselected={handleResourceChanged}
                >
                </builder_platform_interaction-entity-resource-picker>
            </div>
        </div>
    </div>
    <!-- Choose record save trigger (on create vs update) -->
    <div class="slds-border_top slds-p-horizontal_small slds-p-around_medium">
        <div class="slds-form slds-p-horizontal_small slds-size_3-of-4">
            <div class="slds-text-heading_medium slds-p-bottom_x-small">{editTriggerLabel}</div>
            <lightning-radio-group
                class="recordCreateOrUpdate slds-form-element slds-col slds-grow"
                name="recordCreateOrUpdate"
                label={createOrUpdateInputLabel}
                options={createOrUpdateOptions}
                onchange={handleTriggerSaveTypeChange}
                value={saveType}
                required
                type="radio"
            ></lightning-radio-group>
        </div>
    </div>
    <div class="slds-border_top slds-p-around_medium">
        <div class="slds-form slds-size_3-of-4">
            <div class="slds-p-left_small slds-text-heading_medium slds-form-element">{setConditionsHeaderLabel}</div>
            <div class="slds-p-left_small slds-text-body_small slds-text-color_weak slds-p-vertical_x-small">
                <lightning-formatted-rich-text class="test-set-conditions-description" value={setConditionsDescription}>
                </lightning-formatted-rich-text>
            </div>
        </div>
        <div>
            <builder_platform_interaction-record-filter
                hide-title
                hide-new-resource
                hide-system-variables
                hide-global-variables
                show-prefix
                disable-condition-logic-picker={disableConditionLogicPicker}
                element-type={elementType}
                element-guid={startElement.guid}
                filter-items={startElement.filters}
                filter-logic={startElement.filterLogic}
                record-entity-name={recordEntityName}
                record-fields={recordFields}
                variant="startElement"
                onaddrecordfilter={handlePropertyOrListItemChanged}
                onupdaterecordfilter={handlePropertyOrListItemChanged}
                ondeleterecordfilter={handlePropertyOrListItemChanged}
                onpropertychanged={handlePropertyOrListItemChanged}
            >
                <div slot="info" class="slds-m-top_large slds-m-left_medium">
                    <div>
                        <span class="slds-badge slds-m-right_xx-small">{labels.newInfoBadgeLabel}</span>
                        {labels.formulasForConditionsInfoLabel}
                        <lightning-helptext
                            class="slds-m-left_xx-small"
                            content={labels.formulasForConditionsHelpText}
                        ></lightning-helptext>
                    </div>
                </div>
            </builder_platform_interaction-record-filter>
        </div>
        <div class="slds-p-horizontal_small" if:true={showFormulaEditor}>
            <builder_platform_interaction-formula-builder
                label={labels.formulaLabel}
                name={labels.formulaLabel}
                value={startElement.filterFormula}
                validation-options={validationOptions}
                formula-type={formulaType}
                flow-process-type={processType}
                flow-trigger-type={triggerType}
                record-trigger-type={startElement.recordTriggerType.value}
                resource-picker-config={resourcePickerConfig}
                required
                onformulachanged={handlefilterFormulaChanged}
            ></builder_platform_interaction-formula-builder>
        </div>
        <div class="slds-border_top" if:true={showRequireRecordChangeOptions}>
            <div
                class="test-require-record-change-option slds-form_stacked slds-p-top_small slds-p-horizontal_small slds-no-flex"
            >
                <label
                    class="test-require-record-change-option-label slds-form-element__legend slds-form-element__label"
                    >{requireRecordChangeOptionLabel}</label
                >
                <lightning-helptext content={labels.requireChangeOptionsHelptext}></lightning-helptext>
                <lightning-radio-group
                    name="requireRecordChangeOptionsRadioGroup"
                    label={labels.requireRecordChangeOption}
                    options={requireRecordChangeOptions}
                    value={requireRecordChangeOption}
                    disabled={disableRecordChangeOptions}
                    onchange={handleRequireRecordChangeOptionOnChange}
                    class="slds-m-top_x-small executeWhenOption"
                    variant="label-hidden"
                >
                </lightning-radio-group>
            </div>
            <div
                if:true={disableRecordChangeOptions}
                class="slds-scoped-notification slds-media slds-media_center slds-color__background_gray-3 slds-m-left_small slds-m-right_small slds-m-bottom_small"
            >
                <div class="slds-media__figure">
                    <lightning-icon icon-name="utility:info" size="small"></lightning-icon>
                </div>
                <div class="slds-media__body">{labels.disableRadioGroupStartText}</div>
            </div>
        </div>
    </div>
    <!-- choose trigger type (before vs. after save) -->
    <div class="slds-border_top slds-p-horizontal_medium" if:true={showChooseTriggerType}>
        <div class="slds-form">
            <fieldset class="slds-form-element">
                <legend class="slds-form-element__legend slds-form-element__label">
                    <div class="slds-align-top slds-p-top_small slds-p-left_small">
                        <abbr class="slds-required" title={labels.requiredLabel}>*</abbr
                        >{labels.recordChangeTriggerTypeInputLabel}
                    </div>
                </legend>
                <div class="slds-form-element__control">
                    <!-- Display BeforeSave and AfterSave Trigger label and description -->
                    <div if:false={isDeleteRecordTriggerType} class="slds-p-top_small">
                        <builder_platform_interaction-visual-picker-list
                            items={beforeAfterSaveItems}
                            focus-on-rerendering="false"
                            radio-group-name="BeforeAfterSave"
                            onvisualpickerlistchanged={handleTypeSelection}
                        >
                        </builder_platform_interaction-visual-picker-list>
                    </div>
                    <!-- Display Before Delete Trigger label and description if RecordTriggerType "Delete" is selected -->
                    <div if:true={isDeleteRecordTriggerType} class="slds-m-left_large slds-p-top_xx-small">
                        <label class="slds-radio__label afterSave" for="radio-before-delete">
                            <b><span class="slds-form-element__label">{labels.triggerTypeBeforeDelete}</span></b>
                        </label>

                        <div class="slds-form-element__label slds-form-element">
                            {labels.triggerTypeBeforeDeleteDescription}
                        </div>

                        <div
                            class="beforeDeleteInfo slds-scoped-notification slds-m-bottom_small slds-m-right_small slds-m-top_x-small slds-media slds-media_center slds-color__background_gray-3"
                        >
                            <div class="slds-media__figure">
                                <lightning-icon icon-name="utility:info" size="small"></lightning-icon>
                            </div>
                            <div class="slds-media__body">{labels.noUndeleteFlowMessage}</div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>

    <div class="slds-p-horizontal_medium slds-m-bottom_large" if:true={showrunAsync}>
        <lightning-input
            label={runAsyncScheduledPathCheckboxLabel}
            type="checkbox"
            disabled={disablerunAsyncScheduledPathCheckbox}
            checked={checkrunAsyncScheduledPath}
            onchange={togglerunAsyncScheduledPath}
            class="test-input-selection-checkbox slds-p-left_medium"
        >
        </lightning-input>
    </div>
</template>
