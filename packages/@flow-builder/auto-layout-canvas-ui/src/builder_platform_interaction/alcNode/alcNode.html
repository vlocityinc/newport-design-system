<template>
    <builder_platform_interaction-focus-trap enabled={isFocusTrapEnabled} onfocusout={handleFocusOut}>
        <div class={iconContainerClasses}>
            <builder_platform_interaction-alc-menu-trigger
                element-metadata={nodeInfo.metadata}
                source={source}
                menu-opened={menu}
                has-error={nodeHasError}
                canvas-mode={canvasMode}
                operation-type={nodeInfo.operationType}
                onclick={handleButtonClick}
                ondblclick={handleOnDblClick}
                active-element-guid={activeElementGuid}
                disable-edit-elements={disableEditElements}
                variant={menuTriggerVariant}
                class={menuTriggerClass}
            >
                <!-- Element Icon -->
                <!-- icon-name is ignored if src is supplied -->
                <div slot="trigger" class={rotateIconClass}>
                    <lightning-icon
                        alternative-text={labels.nodeIconAltText}
                        class={svgClass}
                        icon-name={iconName}
                        size={iconSize}
                        src={iconSrc}
                        variant="inverse"
                        aria-label={iconAriaLabel}
                        aria-haspopup="dialog"
                        aria-describedby="secondary"
                    ></lightning-icon>
                    <div class="slds-assistive-text" id="secondary">{nodeAriaInfo}</div>
                </div>

                <!-- Selection Checkbox -->
                <lightning-button-icon
                    if:true={showCheckboxInSelectionMode}
                    slot="selection-checkbox"
                    alternative-text={labels.selectionCheckboxAltText}
                    class="selection-checkbox"
                    disabled={shouldDisableCheckbox}
                    icon-name={checkboxIconName}
                    size="small"
                    variant={checkboxVariant}
                    onclick={handleSelectionCheckboxClick}
                    aria-label={labels.checkboxLabel}
                ></lightning-button-icon>
            </builder_platform_interaction-alc-menu-trigger>
            <!-- Label and Element Type -->
            <div class={textContainerClasses}>
                <div if:false={dynamicNodeConstructor}>
                    <div class="text-element-label slds-text-body_regular">{nodeLabel}</div>
                    <div if:true={showElementType} class="text-element-type slds-text-body_regular slds-truncate">
                        {nodeInfo.metadata.label}
                    </div>
                </div>
                <a
                    if:true={hasIncomingGoto}
                    href="#"
                    class="slds-text-body_regular slds-truncate text-incoming-goto"
                    onclick={handleIncomingStubClick}
                >
                    {incomingGoToLabel}
                </a>
            </div>

            <!--Error icon-->
            <lightning-icon
                if:true={nodeHasError}
                icon-name="utility:error"
                variant="error"
                size="xx-small"
                alternative-text={labels.errorIconAlternativeText}
                title={labels.errorIconTitle}
                class="error-icon slds-is-absolute slds-button-icon_small"
            ></lightning-icon>
        </div>
        <x-lazy
            if:true={dynamicNodeConstructor}
            lwc:dynamic={dynamicNodeConstructor}
            node={nodeInfo}
            is-default-mode={isDefaultCanvasMode}
            active-element-guid={activeElementGuid}
            class={dynamicNodeClasses}
            canvas-context={canvasContext}
            disable-delete-elements={disableDeleteElements}
            disable-edit-elements={disableEditElements}
            onpopovertoggled={handlePopoverToggled}
        ></x-lazy>
        <x-lazy
            if:true={menu}
            lwc:dynamic={menu.ctor}
            guid={menu.source.guid}
            class="menu"
            auto-focus={menu.autoFocus}
            element-metadata={elementMetadata}
            flow-model={flowModel}
            disable-delete-elements={disableDeleteElements}
            disable-edit-elements={disableEditElements}
        ></x-lazy>
    </builder_platform_interaction-focus-trap>
</template>
